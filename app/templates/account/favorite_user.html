{% extends 'base.html' %}
{% import 'macros/form_macros.html' as f %}

{% block content %}
<div class="container mt-4" id="main-container">
    <h2 class="mb-4"><i class="fas fa-heart"></i> My Favorite Rules</h2>

    <template v-if="rules_list_favorite && rules_list_favorite.length > 0">
        <div class="list-group" v-for="(rule, index) in rules_list_favorite" :key="rule.id">
            <div class="list-group-item d-flex justify-content-between align-items-center mb-3">
                <div class="me-3">
                    <h5 class="mb-1">[[ rule.title ]]</h5>
                    <p class="mb-1 text-muted"><em>[[ rule.description ]]</em></p>
                    <small class="text-muted">Added on [[ rule.creation_date ]]</small>
                </div>

                <div class="btn-group">
                    <a :href="'/detail_rule/' + rule.id" class="btn btn-info btn-sm me-2" title="View Details">
                        <i class="fas fa-eye"></i> View Details
                    </a>

                    <button @click="deleteRule(rule.id, index)" class="btn btn-danger btn-sm">
                        <i class="fas fa-trash-alt"></i> 
                    </button>
                </div>
            </div>
        </div>
    </template>

    <template v-else>
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i> You don't have any favorite rules yet.
        </div>
    </template>  
</div>
{% endblock %}

{% block script %}
<script type="module">
    const { createApp, ref } = Vue;
    import { message_list } from '/static/js/toaster.js';

    createApp({
      delimiters: ['[[', ']]'],
      setup() {
        const rules_list_favorite = ref([]);

        async function deleteRule(id, index) {
            const res = await fetch('/account/favorite/delete_rule?id=' + id)
            const data = await res.json()
            const acces = data.success
            if(acces){
                rules_list_favorite.value.splice(index, 1)
            }
        }

        async function fetchRules(page) {
            const res = await fetch(`/account/favorite/get_rules_page_favorite?page=${page}`);
            const data = await res.json();
            rules_list_favorite.value = data.rule;
        }

        fetchRules(1)

        return {
          rules_list_favorite,
          fetchRules,
          deleteRule
        };
      }
    }).mount('#main-container');
</script>
{% endblock %}
