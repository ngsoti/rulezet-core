{% extends 'base.html' %}
{% import 'macros/form_macros.html' as f %}

{% block content %}
    <form action="" method="post">
        {{ form.hidden_tag() }}
        <div class="modal-body bg-light p-4 rounded shadow-sm">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="{{ form.first_name.id }}" class="col-form-label text-primary">{{ form.first_name.label }}</label>  <span style="color:red">*</span>
                    {{ form.first_name(class_="form-control border-primary") }}
                    {% if form.first_name.errors %}
                        <div class="text-danger">{{ form.first_name.errors[0] | safe }}</div>
                    {% endif %}
                </div>
                
                <div class="col-md-6 mb-3">
                    <label for="{{ form.last_name.id }}" class="col-form-label text-primary">{{ form.last_name.label }}</label>  <span style="color:red">*</span>
                    {{ form.last_name(class_="form-control border-primary") }}
                    {% if form.last_name.errors %}
                        <div class="text-danger">{{ form.last_name.errors[0] | safe }}</div>
                    {% endif %}
                </div>
            </div>
            
            <div class="mb-3">
                <label for="{{ form.email.id }}" class="col-form-label text-primary">{{ form.email.label }}</label>  <span style="color:red">*</span>
                {{ form.email(class_="form-control border-primary") }}
                {% if form.email.errors %}
                    <div class="text-danger">{{ form.email.errors[0] | safe }}</div>
                {% endif %}
            </div>
            <div class="col" id="password-container">
                <label for="password" class="col-form-label">{{ form.password.label }}</label>  
               <muted>
                    <span class="text-muted">(Leave blank to keep current password)</span>
               </muted>
                <div class="position-relative">
                    <div class="position-relative">
                        {{ form.password(class_="form-control pe-5", id="password") }}
                        <script>
                            document.getElementById("password").setAttribute("v-model", "password");
                        </script>
                        <i class="fa fa-eye position-absolute top-50 end-0 translate-middle-y me-3"
                        style="cursor: pointer"
                        id="togglePasswordIcon"
                        @click="togglePassword"></i>
                    </div>

                </div>
                {% if form.password.errors %}
                    <div style="color: red;">{{ form.password.errors[0] | safe }}</div>
                {% endif %}
                <template v-if="password != '' " >
                    <!-- Password rules -->
                    <ul style="margin-top: 10px; padding-left: 20px; list-style: none;">
                        <li :class="password.length >= 8 ? 'text-success' : 'text-danger'">
                            <span v-if="password.length >= 8"><i class="fa-solid fa-check"></i></span><span v-else><i class="fa-solid fa-xmark"></i></span> At least 8 characters
                        </li>
                        <li :class="/[A-Z]/.test(password) ? 'text-success' : 'text-danger'">
                            <span v-if="/[A-Z]/.test(password)"><i class="fa-solid fa-check"></i></span><span v-else><i class="fa-solid fa-xmark"></i></span> At least one uppercase letter
                        </li>
                        <li :class="/[a-z]/.test(password) ? 'text-success' : 'text-danger'">
                            <span v-if="/[a-z]/.test(password)"><i class="fa-solid fa-check"></i></span><span v-else><i class="fa-solid fa-xmark"></i></span> At least one lowercase letter
                        </li>
                        <li :class="/[0-9]/.test(password) ? 'text-success' : 'text-danger'">
                            <span v-if="/[0-9]/.test(password)"><i class="fa-solid fa-check"></i></span><span v-else><i class="fa-solid fa-xmark"></i></span> At least one digit
                        </li>
                        <li :class="/[@$!%*?&]/.test(password) ? 'text-success' : 'text-danger'">
                            <span v-if="/[@$!%*?&]/.test(password)"><i class="fa-solid fa-check"></i></span><span v-else><i class="fa-solid fa-xmark"></i></span> At least one special character (@$!%*?&)
                        </li>
                    </ul>
                </template>
                
            </div>



            <div class="modal-footer mt-3">
                {{ form.submit(class_="btn btn-success",  id='submitBtn') }}
            </div>
        </div>
    </form>
{% endblock %}

{% block script %}
<script type="module">
const { createApp, ref, computed, onMounted, watch } = Vue;

createApp({
    setup() {
        const password = ref('');

        const passwordValid = computed(() => {
            return password.value.length >= 8 &&
                   /[A-Z]/.test(password.value) &&
                   /[a-z]/.test(password.value) &&
                   /[0-9]/.test(password.value) &&
                   /[@$!%*?&]/.test(password.value);
        });

        const togglePassword = () => {
            const input = document.getElementById("password");
            const icon = document.getElementById("togglePasswordIcon");
            input.type = input.type === "password" ? "text" : "password";
            icon.classList.toggle("fa-eye");
            icon.classList.toggle("fa-eye-slash");
        };


        return { password, togglePassword, passwordValid };
    }
}).mount('#password-container');
</script>
{% endblock %}
